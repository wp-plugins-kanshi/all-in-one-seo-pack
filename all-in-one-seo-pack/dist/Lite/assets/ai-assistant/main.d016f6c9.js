import{r as ye,m as U}from"../js/utils.3c550046.js";import{b as Ce,a as q,c as se}from"../js/runtime-dom.esm-bundler.f6259c83.js";import{a as xe}from"../js/icon.17530d89.js";import{l as re}from"../js/index.7c01c5f2.js";import{d as $e,am as Ee,a2 as K,p as Ae,u as Se,l as ae,a6 as Te,V as Ie,c as Me,m as ie}from"../js/index.ed1fc0db.js";import"../js/translations.d159963e.js";import{C as Pe}from"../js/CreditCounter.8275c1de.js";import{a as Be}from"../js/allowed.8a9179cc.js";import{s as he,_ as m}from"../js/default-i18n.20001971.js";import{o as B,c as Z,m as _e,T as R,a as C,$ as Y,Z as N,X as V,g as Oe,n as ne,a9 as Re,aj as Le,a1 as L,a2 as W,a4 as H,a5 as De,x as He,h as ce}from"../js/runtime-core.esm-bundler.4f558f23.js";import{G as Ne}from"../js/constants.fe8bda37.js";import{_ as J}from"../js/Button.e237bb50.js";import{C as le}from"../js/Index.504e4ac6.js";import{_ as Fe}from"../js/_plugin-vue_export-helper.eefbdd86.js";import{_ as ze}from"../js/Trash.263ee9c7.js";import{o as ue}from"../js/helpers.2a6f0df7.js";import"../js/datetime.f197aeae.js";import"../js/Tooltip.447e44bb.js";import"../js/Close.8fb798f7.js";function Ge(n,t,s,o){const i=Number(n[t].meta.id+1).toString();let d="";return typeof o.docId=="string"&&(d=`-${o.docId}-`),d+i}function je(n,t){let s=Number(n[t].meta.id+1).toString();return n[t].meta.subId>0&&(s+=`:${n[t].meta.subId}`),`[${s}]`}function Ue(n,t,s,o,i){const d=i.rules.footnote_anchor_name(n,t,s,o,i),h=i.rules.footnote_caption(n,t,s,o,i);let e=d;return n[t].meta.subId>0&&(e+=`:${n[t].meta.subId}`),`<sup class="footnote-ref"><a href="#fn${d}" id="fnref${e}">${h}</a></sup>`}function qe(n,t,s){return(s.xhtmlOut?`<hr class="footnotes-sep" />
`:`<hr class="footnotes-sep">
`)+`<section class="footnotes">
<ol class="footnotes-list">
`}function Ve(){return`</ol>
</section>
`}function We(n,t,s,o,i){let d=i.rules.footnote_anchor_name(n,t,s,o,i);return n[t].meta.subId>0&&(d+=`:${n[t].meta.subId}`),`<li id="fn${d}" class="footnote-item">`}function Je(){return`</li>
`}function Ye(n,t,s,o,i){let d=i.rules.footnote_anchor_name(n,t,s,o,i);return n[t].meta.subId>0&&(d+=`:${n[t].meta.subId}`),` <a href="#fnref${d}" class="footnote-backref">↩︎</a>`}function Ze(n){const t=n.helpers.parseLinkLabel,s=n.utils.isSpace;n.renderer.rules.footnote_ref=Ue,n.renderer.rules.footnote_block_open=qe,n.renderer.rules.footnote_block_close=Ve,n.renderer.rules.footnote_open=We,n.renderer.rules.footnote_close=Je,n.renderer.rules.footnote_anchor=Ye,n.renderer.rules.footnote_caption=je,n.renderer.rules.footnote_anchor_name=Ge;function o(e,r,p,l){const u=e.bMarks[r]+e.tShift[r],k=e.eMarks[r];if(u+4>k||e.src.charCodeAt(u)!==91||e.src.charCodeAt(u+1)!==94)return!1;let a;for(a=u+2;a<k;a++){if(e.src.charCodeAt(a)===32)return!1;if(e.src.charCodeAt(a)===93)break}if(a===u+2||a+1>=k||e.src.charCodeAt(++a)!==58)return!1;if(l)return!0;a++,e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.refs||(e.env.footnotes.refs={});const f=e.src.slice(u+2,a-2);e.env.footnotes.refs[`:${f}`]=-1;const v=new e.Token("footnote_reference_open","",1);v.meta={label:f},v.level=e.level++,e.tokens.push(v);const y=e.bMarks[r],$=e.tShift[r],M=e.sCount[r],T=e.parentType,E=a,I=e.sCount[r]+a-(e.bMarks[r]+e.tShift[r]);let _=I;for(;a<k;){const b=e.src.charCodeAt(a);if(s(b))b===9?_+=4-_%4:_++;else break;a++}e.tShift[r]=a-E,e.sCount[r]=_-I,e.bMarks[r]=E,e.blkIndent+=4,e.parentType="footnote",e.sCount[r]<e.blkIndent&&(e.sCount[r]+=e.blkIndent),e.md.block.tokenize(e,r,p,!0),e.parentType=T,e.blkIndent-=4,e.tShift[r]=$,e.sCount[r]=M,e.bMarks[r]=y;const w=new e.Token("footnote_reference_close","",-1);return w.level=--e.level,e.tokens.push(w),!0}function i(e,r){const p=e.posMax,l=e.pos;if(l+2>=p||e.src.charCodeAt(l)!==94||e.src.charCodeAt(l+1)!==91)return!1;const u=l+2,k=t(e,l+1);if(k<0)return!1;if(!r){e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.list||(e.env.footnotes.list=[]);const a=e.env.footnotes.list.length,f=[];e.md.inline.parse(e.src.slice(u,k),e.md,e.env,f);const v=e.push("footnote_ref","",0);v.meta={id:a},e.env.footnotes.list[a]={content:e.src.slice(u,k),tokens:f}}return e.pos=k+1,e.posMax=p,!0}function d(e,r){const p=e.posMax,l=e.pos;if(l+3>p||!e.env.footnotes||!e.env.footnotes.refs||e.src.charCodeAt(l)!==91||e.src.charCodeAt(l+1)!==94)return!1;let u;for(u=l+2;u<p;u++){if(e.src.charCodeAt(u)===32||e.src.charCodeAt(u)===10)return!1;if(e.src.charCodeAt(u)===93)break}if(u===l+2||u>=p)return!1;u++;const k=e.src.slice(l+2,u-1);if(typeof e.env.footnotes.refs[`:${k}`]>"u")return!1;if(!r){e.env.footnotes.list||(e.env.footnotes.list=[]);let a;e.env.footnotes.refs[`:${k}`]<0?(a=e.env.footnotes.list.length,e.env.footnotes.list[a]={label:k,count:0},e.env.footnotes.refs[`:${k}`]=a):a=e.env.footnotes.refs[`:${k}`];const f=e.env.footnotes.list[a].count;e.env.footnotes.list[a].count++;const v=e.push("footnote_ref","",0);v.meta={id:a,subId:f,label:k}}return e.pos=u,e.posMax=p,!0}function h(e){let r,p,l,u=!1;const k={};if(!e.env.footnotes||(e.tokens=e.tokens.filter(function(f){return f.type==="footnote_reference_open"?(u=!0,p=[],l=f.meta.label,!1):f.type==="footnote_reference_close"?(u=!1,k[":"+l]=p,!1):(u&&p.push(f),!u)}),!e.env.footnotes.list))return;const a=e.env.footnotes.list;e.tokens.push(new e.Token("footnote_block_open","",1));for(let f=0,v=a.length;f<v;f++){const y=new e.Token("footnote_open","",1);if(y.meta={id:f,label:a[f].label},e.tokens.push(y),a[f].tokens){r=[];const T=new e.Token("paragraph_open","p",1);T.block=!0,r.push(T);const E=new e.Token("inline","",0);E.children=a[f].tokens,E.content=a[f].content,r.push(E);const I=new e.Token("paragraph_close","p",-1);I.block=!0,r.push(I)}else a[f].label&&(r=k[`:${a[f].label}`]);r&&(e.tokens=e.tokens.concat(r));let $;e.tokens[e.tokens.length-1].type==="paragraph_close"?$=e.tokens.pop():$=null;const M=a[f].count>0?a[f].count:1;for(let T=0;T<M;T++){const E=new e.Token("footnote_anchor","",0);E.meta={id:f,subId:T,label:a[f].label},e.tokens.push(E)}$&&e.tokens.push($),e.tokens.push(new e.Token("footnote_close","",-1))}e.tokens.push(new e.Token("footnote_block_close","",-1))}n.block.ruler.before("reference","footnote_def",o,{alt:["paragraph","reference"]}),n.inline.ruler.after("image","footnote_inline",i),n.inline.ruler.after("footnote_inline","footnote_ref",d),n.core.ruler.after("inline","footnote_tail",h)}function Ke(n){function t(o,i){const d=o.pos,h=o.src.charCodeAt(d);if(i||h!==61)return!1;const e=o.scanDelims(o.pos,!0);let r=e.length;const p=String.fromCharCode(h);if(r<2)return!1;if(r%2){const l=o.push("text","",0);l.content=p,r--}for(let l=0;l<r;l+=2){const u=o.push("text","",0);u.content=p+p,!(!e.can_open&&!e.can_close)&&o.delimiters.push({marker:h,length:0,jump:l/2,token:o.tokens.length-1,end:-1,open:e.can_open,close:e.can_close})}return o.pos+=e.length,!0}function s(o,i){const d=[],h=i.length;for(let e=0;e<h;e++){const r=i[e];if(r.marker!==61||r.end===-1)continue;const p=i[r.end],l=o.tokens[r.token];l.type="mark_open",l.tag="mark",l.nesting=1,l.markup="==",l.content="";const u=o.tokens[p.token];u.type="mark_close",u.tag="mark",u.nesting=-1,u.markup="==",u.content="",o.tokens[p.token-1].type==="text"&&o.tokens[p.token-1].content==="="&&d.push(p.token-1)}for(;d.length;){const e=d.pop();let r=e+1;for(;r<o.tokens.length&&o.tokens[r].type==="mark_close";)r++;if(r--,e!==r){const p=o.tokens[r];o.tokens[r]=o.tokens[e],o.tokens[e]=p}}}n.inline.ruler.before("emphasis","mark",t),n.inline.ruler2.before("emphasis","mark",function(o){let i;const d=o.tokens_meta,h=(o.tokens_meta||[]).length;for(s(o,o.delimiters),i=0;i<h;i++)d[i]&&d[i].delimiters&&s(o,d[i].delimiters)})}const Xe=/\\([ \\!"#$%&'()*+,./:;<=>?@[\]^_`{|}~-])/g;function Qe(n,t){const s=n.posMax,o=n.pos;if(n.src.charCodeAt(o)!==126||t||o+2>=s)return!1;n.pos=o+1;let i=!1;for(;n.pos<s;){if(n.src.charCodeAt(n.pos)===126){i=!0;break}n.md.inline.skipToken(n)}if(!i||o+1===n.pos)return n.pos=o,!1;const d=n.src.slice(o+1,n.pos);if(d.match(/(^|[^\\])(\\\\)*\s/))return n.pos=o,!1;n.posMax=n.pos,n.pos=o+1;const h=n.push("sub_open","sub",1);h.markup="~";const e=n.push("text","",0);e.content=d.replace(Xe,"$1");const r=n.push("sub_close","sub",-1);return r.markup="~",n.pos=n.posMax+1,n.posMax=s,!0}function en(n){n.inline.ruler.after("emphasis","sub",Qe)}const nn=/\\([ \\!"#$%&'()*+,./:;<=>?@[\]^_`{|}~-])/g;function on(n,t){const s=n.posMax,o=n.pos;if(n.src.charCodeAt(o)!==94||t||o+2>=s)return!1;n.pos=o+1;let i=!1;for(;n.pos<s;){if(n.src.charCodeAt(n.pos)===94){i=!0;break}n.md.inline.skipToken(n)}if(!i||o+1===n.pos)return n.pos=o,!1;const d=n.src.slice(o+1,n.pos);if(d.match(/(^|[^\\])(\\\\)*\s/))return n.pos=o,!1;n.posMax=n.pos,n.pos=o+1;const h=n.push("sup_open","sup",1);h.markup="^";const e=n.push("text","",0);e.content=d.replace(nn,"$1");const r=n.push("sup_close","sup",-1);return r.markup="^",n.pos=n.posMax+1,n.posMax=s,!0}function tn(n){n.inline.ruler.after("emphasis","sup",on)}const ke=$e("AiAssistantStore",{state:()=>({markdownConverter:new Ee({breaks:!0}).disable("image").use(Ze).use(Ke).use(en).use(tn),capability:"aioseo_page_ai_content_settings",options:{input:{userPrompt:{maxlength:1e3}}},generationPrice:50}),getters:{hasPermission:n=>Be(n.capability)}}),sn="https://schemas.wp.org/wp/5.8/block.json",rn="aioseo/ai-assistant",an="AIOSEO - AI Assistant",cn="aioseo",ln="Quickly generate content using Artificial Intelligence.",un={html:!1,multiple:!0,reusable:!1,customClassName:!1},pn={content:{type:"string",default:""},userPrompt:{type:"string",default:""},messages:{type:"array",default:null},isFetching:{type:"boolean",default:!1},tone:{type:"string",default:""},audience:{type:"string",default:""}},fn=["aioseo","ai","content","generator","generate","assistant","help","magic","intelligence"],dn="all-in-one-seo-pack",mn={$schema:sn,name:rn,title:an,category:cn,description:ln,supports:un,attributes:pn,keywords:fn,textdomain:dn},hn={class:"aioseo-ai-assistant-sidebar"},_n={class:"aioseo-ai-assistant-sidebar-cost"},kn={__name:"Sidebar",setup(n){const t="all-in-one-seo-pack",s=ke(),o={cost:he(m("Each AI Assistant request costs %1$s credits.",t),s.generationPrice.toLocaleString())};return(i,d)=>(B(),Z("div",hn,[_e(R(Pe),{"tooltip-placement":"bottom","tooltip-offset":"-90px,0","parent-component-context":"sidebar"}),C("div",_n,Y(o.cost),1)]))}};async function bn(n,t){const s=n.getReader();let o;for(;!(o=await s.read()).done;)t(o.value)}function gn(n){let t,s,o,i=!1;return function(h){t===void 0?(t=h,s=0,o=-1):t=wn(t,h);const e=t.length;let r=0;for(;s<e;){i&&(t[s]===10&&(r=++s),i=!1);let p=-1;for(;s<e&&p===-1;++s)switch(t[s]){case 58:o===-1&&(o=s-r);break;case 13:i=!0;case 10:p=s;break}if(p===-1)break;n(t.subarray(r,p),o),r=s,o=-1}r===e?t=void 0:r!==0&&(t=t.subarray(r),s-=r)}}function vn(n,t,s){let o=pe();const i=new TextDecoder;return function(h,e){if(h.length===0)s==null||s(o),o=pe();else if(e>0){const r=i.decode(h.subarray(0,e)),p=e+(h[e+1]===32?2:1),l=i.decode(h.subarray(p));switch(r){case"data":o.data=o.data?o.data+`
`+l:l;break;case"event":o.event=l;break;case"id":n(o.id=l);break;case"retry":const u=parseInt(l,10);isNaN(u)||t(o.retry=u);break}}}}function wn(n,t){const s=new Uint8Array(n.length+t.length);return s.set(n),s.set(t,n.length),s}function pe(){return{data:"",event:"",id:"",retry:void 0}}var yn=function(n,t){var s={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&t.indexOf(o)<0&&(s[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(n);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(s[o[i]]=n[o[i]]);return s};const oe="text/event-stream",Cn=1e3,fe="last-event-id";function xn(n,t){var{signal:s,headers:o,onopen:i,onmessage:d,onclose:h,onerror:e,openWhenHidden:r,fetch:p}=t,l=yn(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((u,k)=>{const a=Object.assign({},o);a.accept||(a.accept=oe);let f;function v(){f.abort(),document.hidden||I()}r||document.addEventListener("visibilitychange",v);let y=Cn,$=0;function M(){document.removeEventListener("visibilitychange",v),window.clearTimeout($),f.abort()}s==null||s.addEventListener("abort",()=>{M(),u()});const T=p??window.fetch,E=i??$n;async function I(){var _;f=new AbortController;try{const w=await T(n,Object.assign(Object.assign({},l),{headers:a,signal:f.signal}));await E(w),await bn(w.body,gn(vn(b=>{b?a[fe]=b:delete a[fe]},b=>{y=b},d))),h==null||h(),M(),u()}catch(w){if(!f.signal.aborted)try{const b=(_=e==null?void 0:e(w))!==null&&_!==void 0?_:y;window.clearTimeout($),$=window.setTimeout(I,b)}catch(b){M(),k(b)}}}I()})}function $n(n){const t=n.headers.get("content-type");if(!(t!=null&&t.startsWith(oe)))throw new Error(`Expected content-type to be ${oe}, Actual: ${t}`)}const En={},An={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",class:"aioseo-renew"},Sn=C("path",{d:"M3.39984 10.7C3.15539 10.2777 2.97206 9.8444 2.84984 9.39996C2.72762 8.95551 2.6665 8.49996 2.6665 8.03329C2.6665 6.5444 3.18317 5.27774 4.2165 4.23329C5.24984 3.18885 6.51095 2.66663 7.99984 2.66663H8.1165L7.04984 1.59996L7.98317 0.666626L10.6498 3.33329L7.98317 5.99996L7.04984 5.06663L8.1165 3.99996H7.99984C6.88873 3.99996 5.94428 4.39163 5.1665 5.17496C4.38873 5.95829 3.99984 6.91107 3.99984 8.03329C3.99984 8.32218 4.03317 8.60552 4.09984 8.88329C4.1665 9.16107 4.2665 9.43329 4.39984 9.69996L3.39984 10.7ZM8.0165 15.3333L5.34984 12.6666L8.0165 9.99996L8.94984 10.9333L7.88317 12H7.99984C9.11095 12 10.0554 11.6083 10.8332 10.825C11.6109 10.0416 11.9998 9.08885 11.9998 7.96663C11.9998 7.67774 11.9665 7.3944 11.8998 7.11663C11.8332 6.83885 11.7332 6.56663 11.5998 6.29996L12.5998 5.29996C12.8443 5.72218 13.0276 6.15552 13.1498 6.59996C13.2721 7.0444 13.3332 7.49996 13.3332 7.96663C13.3332 9.45551 12.8165 10.7222 11.7832 11.7666C10.7498 12.8111 9.48873 13.3333 7.99984 13.3333H7.88317L8.94984 14.4L8.0165 15.3333Z",fill:"currentColor"},null,-1),Tn=[Sn];function In(n,t){return B(),Z("svg",An,Tn)}const Mn=Fe(En,[["render",In]]),Pn={class:"aioseo-ai-assistant-block"},Bn={class:"aioseo-ai-assistant-block__head"},On=["innerHTML"],Rn={class:"aioseo-ai-assistant-block__body"},Ln={class:"aioseo-ai-assistant-block__input-container"},Dn={class:"aioseo-ai-assistant-block__input-row"},Hn={class:"aioseo-ai-assistant-block__input-col aioseo-ai-assistant-block__input-col--grow"},Nn=["placeholder","disabled","maxlength"],Fn={class:"aioseo-ai-assistant-block__input-col"},zn={class:"aioseo-ai-assistant-block__controls"},Gn={key:1},jn={class:"aioseo-ai-assistant-block__input-row aioseo-ai-assistant-block__input-row--gray"},Un={class:"aioseo-ai-assistant-block__input-col aioseo-ai-assistant-block__input-col--disclaimer"},qn=["innerHTML"],Vn={class:"aioseo-ai-assistant-block__error-container"},Wn={__name:"Block",setup(n){const t="all-in-one-seo-pack",{toneOptions:s,audienceOptions:o,hasEnoughCredits:i}=K(),d=ke(),h=Ae(),e=Se(),r=N(null),p=N({}),l=N(null),u=N(""),k=N({api:null}),a=He(),f={aiTextGenerator:m("AI Text Generator",t),insert:m("Insert",t),placeholder:m("Write a blog about... Generate a table for...",t),requestUnsuccessful:m("The request was unsuccessful. Status code:",t),generate:m("Generate",t),stop:m("Stop",t),delete:m("Delete",t),regenerate:m("Regenerate",t),noPermission:m("You do not have permission to use the AI Assistant.",t),disclaimer:he(m("AI-generated content could be inaccurate or biased. %1$s",t),ae.getDocLink(Ne.learnMore,"aiDisclaimer",!0)),userPromptMaxlength:m("You have reached the maximum number of allowed characters.",t)},v=V(()=>{var c;return(c=l.value)==null?void 0:c.closest("[data-block]").dataset.block}),y=V(()=>{var x,O;const c=!!((x=a.root.data.userPrompt)!=null&&x.trim().length),g=!!((O=a.root.data.messages)!=null&&O.length)&&a.root.data.messages.find(we=>we.role==="assistant"),P=!!a.root.data.isFetching,j=!!u.value.length;return{submit:{disabled:!c||!d.hasPermission||!i(d.generationPrice),show:!0,loading:P,text:g?Mn:f.generate,title:g?f.regenerate:"",type:g?"gray":"blue"},insert:{show:j&&!P},stop:{show:P},delete:{show:g&&!P}}}),$=V(()=>d.hasPermission?k.value.api?k.value.api:null:f.noPermission),M=V(()=>a.root.data.userPrompt.length>=d.options.input.userPrompt.maxlength?f.userPromptMaxlength:null),T=()=>{let c=window.wp.blocks.pasteHandler({HTML:u.value,plainText:a.root.data.content,mode:"AUTO"});typeof c=="string"&&(c=window.wp.blocks.createBlock("core/paragraph",{content:c}));const{dispatch:g}=window.wp.data;g("core/block-editor").replaceBlock(v.value,c)},E=()=>{Q(),ne(()=>{ge()})},I=()=>{p.value.abort()},_=()=>{const{dispatch:c}=window.wp.data;c("core/block-editor").removeBlock(v.value)},w=()=>{const c=l.value;c.style.height="auto",c.style.height=c.scrollHeight+"px"},b=()=>{u.value=d.markdownConverter.render(a.root.data.content),w()},te=c=>{const g=a.root.data.messages||[];a.root.data.messages=[...g,c]},X=()=>window.wp.data.select("core/block-editor").getBlock(v.value),be=c=>{if(!c)return!1;const g=c.getBoundingClientRect(),P=window.innerHeight||document.documentElement.clientHeight;return 0<=g.top&&g.top<=P},ge=()=>{r.value&&(be(r.value)||r.value.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}))},ve=()=>{let c="";try{document.querySelectorAll(".aioseo-ai-assistant-block").forEach(g=>{g.style.visibility="hidden"}),c=Ie(!0),c=c.replace(new RegExp(`<!-- wp:${X().name}.*?/-->`,"gs"),""),c&&1e4<c.length&&(c=c.substring(0,1e4))}catch(g){console.warn("Could not retrieve post content for context:",g),c=""}finally{document.querySelectorAll(".aioseo-ai-assistant-block").forEach(g=>{g.style.visibility="visible"})}return c.trim()},Q=(c={})=>{var P,j,ee;p.value=new AbortController,k.value.api=null,a.root.data.isFetching=!0,a.root.data.content="",b();const g={role:"user"};c!=null&&c.translate?g.translate=c.translate:c!=null&&c.improve?g.improve=c.improve:g.content=a.root.data.userPrompt,te(g),xn(ae.restUrl("ai/assistant"),{headers:{"Content-Type":"application/json","X-WP-Nonce":window.aioseo.nonce},method:"POST",body:JSON.stringify({messages:a.root.data.messages,tone:s.find(x=>x.value===X().attributes.tone).label,audience:o.find(x=>x.value===X().attributes.audience).label,postContent:ve(),postTitle:(Te()||"").trim(),focusKeyword:(((ee=(j=(P=e.currentPost)==null?void 0:P.keyphrases)==null?void 0:j.focus)==null?void 0:ee.keyphrase)||"").trim()}),cache:"no-store",openWhenHidden:!0,onclose(){b()},onerror(x){throw x},onmessage(x){const O=JSON.parse(x.data);if(O!=null&&O.error)throw new Error(`${O.error}`);a.root.data.content+=(O==null?void 0:O.content)??"",b()},onopen(x){if(!x.ok)throw new Error(`${f.requestUnsuccessful.trim()} ${x.status}`)},signal:p.value.signal}).catch(x=>{console.error(x),k.value.api=x.message}).then(()=>{if(!a.root.data.content.trim().length){a.root.data.messages.pop();return}te({role:"assistant",content:a.root.data.content})}).finally(async()=>{await h.getCredits(!0),a.root.data.isFetching=!1,await ne(),b()})};return Oe(()=>{b(),window.aioseoBus.$on("aiAssistantTranslateChange",c=>{!c||c.clientId!==v.value||!c.translate||Q({translate:c.translate})}),window.aioseoBus.$on("aiAssistantImproveChange",c=>{!c||c.clientId!==v.value||!c.improve||Q({improve:c.improve})}),ne(()=>{var c;(c=l.value)==null||c.focus()})}),Re(()=>{window.aioseoBus.$off("aiAssistantTranslateChange"),window.aioseoBus.$off("aiAssistantImproveChange")}),(c,g)=>(B(),Z("div",Pn,[C("div",Bn,[C("div",{ref_key:"contentElement",ref:r,class:"aioseo-ai-assistant-block__content",innerHTML:u.value},null,8,On)]),C("div",Rn,[C("div",Ln,[C("div",Dn,[C("div",Hn,[Le(C("textarea",{ref_key:"inputElement",ref:l,class:"aioseo-ai-assistant-block__input",placeholder:f.placeholder,disabled:c.$root.$data.isFetching,"onUpdate:modelValue":g[0]||(g[0]=P=>c.$root.$data.userPrompt=P),onInput:w,rows:"1",maxlength:R(d).options.input.userPrompt.maxlength},null,40,Nn),[[Ce,c.$root.$data.userPrompt]])]),C("div",Fn,[C("div",zn,[y.value.delete.show?(B(),L(R(J),{key:0,size:"small",type:"gray",class:"aioseo-ai-assistant-block__btn",onClick:q(_,["stop","exact"]),title:f.delete},{default:W(()=>[_e(R(ze),{width:"18",height:"18"})]),_:1},8,["title"])):H("",!0),y.value.submit.show?(B(),L(R(J),{key:1,disabled:y.value.submit.disabled,loading:y.value.submit.loading,type:y.value.submit.type,title:y.value.submit.title,size:"small-table",class:"aioseo-ai-assistant-block__btn",onClick:q(E,["stop","exact"])},{default:W(()=>[typeof y.value.submit.text=="object"?(B(),L(De(y.value.submit.text),{key:0,width:"18",height:"18"})):(B(),Z("span",Gn,Y(y.value.submit.text),1))]),_:1},8,["disabled","loading","type","title"])):H("",!0),y.value.insert.show?(B(),L(R(J),{key:2,size:"small-table",type:"blue",class:"aioseo-ai-assistant-block__btn",onClick:q(T,["stop","exact"])},{default:W(()=>[C("span",null,Y(f.insert),1)]),_:1})):H("",!0),y.value.stop.show?(B(),L(R(J),{key:3,size:"small-table",type:"gray",class:"aioseo-ai-assistant-block__btn",onClick:q(I,["stop","exact"])},{default:W(()=>[C("span",null,Y(f.stop),1)]),_:1})):H("",!0)])])]),C("div",jn,[C("div",Un,[C("span",{innerHTML:f.disclaimer},null,8,qn)])])]),C("div",Vn,[$.value?(B(),L(R(le),{key:0,innerHTML:$.value,type:"red",size:"small",style:{"margin-top":"10px"}},null,8,["innerHTML"])):H("",!0),M.value?(B(),L(R(le),{key:1,innerHTML:M.value,type:"yellow",size:"small",style:{"margin-top":"10px"}},null,8,["innerHTML"])):H("",!0)])])]))}},A="all-in-one-seo-pack",S={selectLanguage:m("Select language",A),translate:m("Translate",A),arabic:m("Arabic",A),chinese:m("Chinese",A),dutch:m("Dutch",A),english:m("English",A),french:m("French",A),german:m("German",A),hindi:m("Hindi",A),italian:m("Italian",A),japanese:m("Japanese",A),korean:m("Korean",A),portuguese:m("Portuguese",A),spanish:m("Spanish",A),turkish:m("Turkish",A)},{Dropdown:Jn,ToolbarButton:Yn,ToolbarGroup:Zn,MenuGroup:Kn,MenuItem:Xn}=window.wp.components,Qn=[S.arabic,S.chinese,S.dutch,S.english,S.french,S.german,S.hindi,S.italian,S.japanese,S.korean,S.portuguese,S.spanish,S.turkish],eo=({attributes:n,onChange:t})=>React.createElement(Zn,null,React.createElement(Jn,{popoverProps:{placement:"bottom-start"},renderToggle:({isOpen:s,onToggle:o})=>React.createElement(Yn,{disabled:!n.content||n.isFetching,icon:"admin-site-alt3",label:S.translate,onClick:o,"aria-expanded":s}),renderContent:({onClose:s})=>React.createElement(Kn,{label:S.selectLanguage},Qn.map(o=>React.createElement(Xn,{onClick:()=>{t(o),s()}},o)))})),F="all-in-one-seo-pack",z={improve:m("Improve",F),selectAction:m("Select action",F),summarize:m("Summarize",F),makeLonger:m("Make longer",F),makeShorter:m("Make shorter",F)};var me;const{Dropdown:no,ToolbarButton:oo,ToolbarGroup:to,MenuGroup:so,MenuItem:ro}=((me=window.wp)==null?void 0:me.components)||{},ao=[z.summarize,z.makeLonger,z.makeShorter],io=({attributes:n,onChange:t})=>React.createElement(to,null,React.createElement(no,{popoverProps:{placement:"bottom-start"},renderToggle:({isOpen:s,onToggle:o})=>React.createElement(oo,{disabled:!n.content||n.isFetching,icon:"admin-customizer",label:z.improve,onClick:o,"aria-expanded":s}),renderContent:({onClose:s})=>React.createElement(so,{label:z.selectAction},ao.map(o=>React.createElement(ro,{onClick:()=>{t(o),s()}},o)))})),co="all-in-one-seo-pack",lo={tone:m("Tone",co)},{SelectControl:uo}=window.wp.components,po=({value:n,onChange:t})=>{const{toneOptions:s}=K();return React.createElement(uo,{label:lo.tone,value:n,options:s,onChange:t,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})},fo="all-in-one-seo-pack",mo={audience:m("Audience",fo)},{SelectControl:ho}=window.wp.components,_o=({value:n,onChange:t})=>{const{audienceOptions:s}=K();return React.createElement(ho,{label:mo.audience,value:n,options:s,onChange:t,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})},ko="all-in-one-seo-pack",{name:bo,title:go,description:vo,category:wo,supports:yo,attributes:Co}=mn,G=window.wp,{useEffect:xo}=G.element,{InspectorControls:$o}=G.blockEditor||G.editor,{BlockControls:Eo}=G.blockEditor,de=G.components.PanelBody,D=[],Ao={notFanOfOptions:m("Not a fan of these options? You can set your own tone/audience directly in your prompt.",ko)},So={title:go,description:vo,category:wo,supports:yo,attributes:Co,icon:xe,edit:function({setAttributes:n,attributes:t,clientId:s,className:o,isSelected:i,toggleSelection:d}){const h=Me(),{toneOptions:e,audienceOptions:r}=K(),p=`aioseo-block-${s}`,l=`aioseo-sidebar-${s}`,u=document.getElementById(p),k=document.querySelector(".block-editor");window.wp.data.useSelect(_=>_("core/edit-post").getActiveGeneralSidebarName())==="edit-post/block"&&(typeof d!="function"||d(!0)),(i||u)&&ue({id:p,parent:k,subtree:!0,loop:!1,done:_=>{if(_.firstChild)return;U(p,D);let w=se({name:"Blocks/AiAssistant",data:()=>t,watch:{"$data.userPrompt":{handler:function(b){n({userPrompt:b})}},"$data.isFetching":{handler:function(b){n({isFetching:b})}},"$data.content":{handler:function(b){n({content:b})}},"$data.messages":{handler:function(b){n({messages:b})}}},render:()=>ce(Wn)});w=re(w),ie(w),w.mount(_),D.push({id:p,app:w})}});const f=D.find(_=>l===_.id),v=document.querySelector(".interface-interface-skeleton__sidebar");u&&v&&(!f||!v.contains(f.app._container))&&ue({id:l,parent:v,subtree:!0,loop:!1,done:_=>{U(l,D);let w=se({name:"Blocks/AiAssistant/Sidebar",render:()=>ce(kn)});w=re(w),ie(w),w.mount(_),D.push({id:l,app:w})}}),xo(()=>()=>{U(p,D),U(l,D)},[]);const y=_=>{n({tone:_.toLowerCase()})},$=_=>{n({audience:_.toLowerCase()})},M=_=>{window.aioseoBus.$emit("aiAssistantTranslateChange",{clientId:s,translate:_})},T=_=>{window.aioseoBus.$emit("aiAssistantImproveChange",{clientId:s,improve:_})},E=e.find(_=>_.value===h.options.aiContent.tone)||e[0];t.tone||n({tone:E.value});const I=r.find(_=>_.value===h.options.aiContent.audience)||r[0];return t.audience||n({audience:I.value}),React.createElement(React.Fragment,null,React.createElement(Eo,null,React.createElement(eo,{attributes:t,onChange:M}),React.createElement(io,{attributes:t,onChange:T})),React.createElement($o,null,React.createElement(de,{initialOpen:!0},React.createElement(po,{value:t.tone,onChange:y}),React.createElement(_o,{value:t.audience,onChange:$}),React.createElement("div",null,Ao.notFanOfOptions)),React.createElement(de,{initialOpen:!0},React.createElement("div",{id:l,class:"aioseo-app"}))),React.createElement("div",{className:o},React.createElement("div",{id:p})))},save:function(){return null}};ye({name:bo,settings:So});
